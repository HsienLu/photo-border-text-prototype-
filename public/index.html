<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Photo Border</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>Upload Photo</h1>
  <div id="drop-area">Drag and drop multiple images here or click to select them</div>
  <form id="upload-form" class="upload-form">
    <input type="file" id="image" name="images" multiple accept="image/*" required>
    <div class="options">
      <label>Top <input type="number" id="topBorder" name="topBorder" value="0"></label>
      <label>Bottom <input type="number" id="bottomBorder" name="bottomBorder" value="0"></label>
      <label>Left <input type="number" id="leftBorder" name="leftBorder" value="0"></label>
      <label>Right <input type="number" id="rightBorder" name="rightBorder" value="0"></label>
      <label>Color <input type="color" id="borderColor" name="borderColor" value="#ffffff"></label>
    </div>
    <button type="submit" class="submit-btn">Process</button>
  </form>
  <div id="loading" class="loading" style="display:none;">Processing...</div>
  <h2>Preview</h2>
  <div id="preview-wrapper" style="display:none;">
    <img id="preview-image" class="preview-img" />
  </div>
  <div id="preview-container"></div>
  <button id="download-all" class="download-btn" style="display:none;">Download All</button>
  <script>
    const form = document.getElementById('upload-form');
    const input = document.getElementById('image');
    const dropArea = document.getElementById('drop-area');
    const loading = document.getElementById('loading');
    const downloadAllBtn = document.getElementById('download-all');
    const topField = document.getElementById('topBorder');
    const bottomField = document.getElementById('bottomBorder');
    const leftField = document.getElementById('leftBorder');
    const rightField = document.getElementById('rightBorder');
    const colorField = document.getElementById('borderColor');
    const previewWrapper = document.getElementById('preview-wrapper');
    const previewImage = document.getElementById('preview-image');

    function updatePreviewStyles() {
      const top = parseInt(topField.value, 10) || 0;
      const bottom = parseInt(bottomField.value, 10) || 0;
      const left = parseInt(leftField.value, 10) || 0;
      const right = parseInt(rightField.value, 10) || 0;
      previewWrapper.style.paddingTop = `${top}px`;
      previewWrapper.style.paddingBottom = `${bottom}px`;
      previewWrapper.style.paddingLeft = `${left}px`;
      previewWrapper.style.paddingRight = `${right}px`;
      previewWrapper.style.backgroundColor = colorField.value;
    }

    function renderPreview() {
      if (!input.files || !input.files[0]) {
        previewImage.style.display = 'none';
        previewWrapper.style.display = 'none';
        return;
      }
      const file = input.files[0];
      const reader = new FileReader();
      reader.onload = e => {
        previewImage.src = e.target.result;
        previewImage.style.display = 'block';
        previewWrapper.style.display = 'inline-block';
        updatePreviewStyles();
      };
      reader.readAsDataURL(file);
      updatePreviewStyles();
    }

    input.addEventListener('change', renderPreview);
    [topField, bottomField, leftField, rightField, colorField].forEach(el => {
      el.addEventListener('input', updatePreviewStyles);
    });

    downloadAllBtn.addEventListener('click', () => {
      window.location = '/download-zip';
    });

    dropArea.addEventListener('click', () => input.click());
    ['dragenter', 'dragover'].forEach(event => {
      dropArea.addEventListener(event, e => {
        e.preventDefault();
        dropArea.classList.add('highlight');
      });
    });
    ['dragleave', 'drop'].forEach(event => {
      dropArea.addEventListener(event, e => {
        e.preventDefault();
        dropArea.classList.remove('highlight');
      });
    });
    dropArea.addEventListener('drop', e => {
      const dt = new DataTransfer();
      Array.from(e.dataTransfer.files).forEach(f => dt.items.add(f));
      input.files = dt.files;
      renderPreview();
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (input.files.length === 0) return;
      loading.style.display = 'block';
      downloadAllBtn.style.display = 'none';
      try {
        const formData = new FormData();
        Array.from(input.files).forEach(file => formData.append('images', file));
        formData.append('topBorder', document.getElementById('topBorder').value);
        formData.append('bottomBorder', document.getElementById('bottomBorder').value);
        formData.append('leftBorder', document.getElementById('leftBorder').value);
        formData.append('rightBorder', document.getElementById('rightBorder').value);
        formData.append('borderColor', document.getElementById('borderColor').value);
        const res = await fetch('/upload', { method: 'POST', body: formData });
        if (res.ok) {
          const data = await res.json();
          const container = document.getElementById('preview-container');
          container.innerHTML = '';
          data.urls.forEach(url => {
            const wrapper = document.createElement('div');
            const img = document.createElement('img');
            img.src = url;
            img.className = 'preview-img';
            img.onload = () => (img.style.display = 'block');
            const link = document.createElement('a');
            link.href = url;
            link.download = '';
            link.textContent = 'Download';
            link.className = 'download-btn';
            wrapper.appendChild(img);
            wrapper.appendChild(link);
            container.appendChild(wrapper);
          });
          if (data.urls.length) {
            downloadAllBtn.style.display = 'inline-block';
          }
        } else {
          alert('Processing failed');
        }
      } finally {
        loading.style.display = 'none';
      }
    });
  </script>
  </body>
</html>

